#---------------------------------------
# GSL recommends the following flags
# removed flags: -ansi -Wmissing-prototypes -Wstrict-prototypes -Wconversion -Wnested-externs -Dinline=
GSLRECFLAGS = -Wall -pedantic -Werror -W \
-Wshadow -Wpointer-arith \
-Wcast-qual -Wcast-align -Wwrite-strings \
-fshort-enums -fno-common \
-O3
				
#---------------------------------------
DIRS   = $(addprefix $(srcdir)/, core io gsltools tests)
SRCEXT = cpp
VPATH  = $(srcdir):$(DIRS)

SOURCES = fiducial_cosmology.cpp global_numbers.cpp matrix_helper.cpp one_qso_estimate.cpp quadratic_estimate.cpp \
spectrograph_functions.cpp sq_table.cpp \
fourier_integrator.cpp interpolation.cpp interpolation_2d.cpp \
config_file.cpp io_helper_functions.cpp qso_file.cpp sq_lookup_table_file.cpp
# SOURCES = core/fiducial_cosmology.cpp core/global_numbers.cpp core/matrix_helper.cpp \
# core/one_qso_estimate.cpp core/quadratic_estimate.cpp \
# core/spectrograph_functions.cpp core/sq_table.cpp \
# gsltools/fourier_integrator.cpp gsltools/interpolation.cpp gsltools/interpolation_2d.cpp \
# io/config_file.cpp io/io_helper_functions.cpp io/qso_file.cpp io/sq_lookup_table_file.cpp
OBJECTS = $(SOURCES:.$(SRCEXT)=.o)

# -DHAVE_INLINE for inline declarations in GSL for faster performance
CPPFLAGS += -I$(srcdir) -std=gnu++11 -DHAVE_INLINE $(OPT)
CXXFLAGS = $(GSLRECFLAGS)

.PHONY: all test install uninstall clean

all: LyaPowerEstimate CreateSQLookUpTable

test: cblas_tests
	
LyaPowerEstimate: LyaPowerEstimate.o $(OBJECTS)
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) $^ -o $@ $(LDFLAGS) $(LDLIBS)

CreateSQLookUpTable: CreateSQLookUpTable.o $(OBJECTS)
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) $^ -o $@ $(LDFLAGS) $(LDLIBS)

cblas_tests: cblas_tests.o matrix_helper.o
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) $^ -o $@ $(LDFLAGS) $(LDLIBS)

install: LyaPowerEstimate CreateSQLookUpTable
	mkdir -p $(bindir)
	cp LyaPowerEstimate CreateSQLookUpTable $(srcdir)/py/lorentzian_fit.py $(bindir)
	chmod a+x $(bindir)/lorentzian_fit.py

uninstall:
	$(RM) $(bindir)/lorentzian_fit.py
	$(RM) $(bindir)/LyaPowerEstimate $(bindir)/CreateSQLookUpTable

clean:
	$(RM) $(OBJECTS) 
	$(RM) LyaPowerEstimate LyaPowerEstimate.o
	$(RM) CreateSQLookUpTable CreateSQLookUpTable.o
	$(RM) cblas_tests cblas_tests.o
